
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análise Histórica da Gasolina (1980-2025)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 60vh;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 500px;
            }
        }
        .kpi-value {
            font-size: 2.5rem;
            line-height: 1.1;
        }
        .loading-animation {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #005F73;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-[#F0F4F8]">

    <div class="container mx-auto p-4 md:p-8">
        
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-[#005F73] mb-2">Gasolina: 45 Anos de Influências no Brasil</h1>
            <p class="text-lg md:text-xl text-[#0A9396]">O papel do Dólar, Petróleo Brent e Impostos no preço do combustível (1980-2025).</p>
        </header>

        <main class="space-y-12">

            <!-- Seção de Gráfico Histórico -->
            <section class="bg-white rounded-lg shadow-lg p-6 md:p-8">
                <h2 class="text-2xl font-bold text-[#005F73] mb-4 text-center">A Batalha das Variáveis: Câmbio, Commodity e Fiscal</h2>
                <p class="text-center text-gray-600 mb-6 max-w-3xl mx-auto">
                    Este gráfico de 45 anos mostra a complexa relação entre o preço internacional do petróleo (dólar, amarelo), a cotação do câmbio (dólar, verde) e o preço final da gasolina (azul). Os **Impostos (vermelho)** demonstram ser a variável mais controlável pelo governo, sendo a chave para a estabilização ou desestabilização do preço ao consumidor em momentos cruciais.
                </p>
                <div class="chart-container">
                    <canvas id="trendsChart"></canvas>
                </div>
            </section>
            
            <!-- Seção de KPIs (Mantida) -->
            <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 text-center">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="font-bold text-[#CA6702] text-lg">Pico Histórico Brent</h3>
                    <p class="kpi-value font-bold text-[#BB3E03]">$147</p>
                    <p class="text-gray-600">Alcançado brevemente em 2008, refletindo-se na pressão dos custos.</p>
                </div>
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="font-bold text-[#CA6702] text-lg">Era do Câmbio Fixo</h3>
                    <p class="kpi-value font-bold text-[#BB3E03]">R$ 0,85</p>
                    <p class="text-gray-600">Cotação do Dólar no início do Plano Real (1994).</p>
                </div>
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="font-bold text-[#CA6702] text-lg">Gasolina Mais Barata (Real)</h3>
                    <p class="kpi-value font-bold text-[#BB3E03]">R$ 1,05</p>
                    <p class="text-gray-600">Preço ajustado em 1994 (Real), o menor em 45 anos.</p>
                </div>
                 <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="font-bold text-[#CA6702] text-lg">Maior Carga Tributária</h3>
                    <p class="kpi-value font-bold text-[#BB3E03]">48%</p>
                    <p class="text-gray-600">Percentual médio de impostos no preço final em anos sem desoneração.</p>
                </div>
            </section>

            <!-- Seção do Simulador de Preços (Gemini API) -->
            <section class="bg-[#D8F0F8] rounded-lg shadow-xl p-6 md:p-8 border-l-4 border-[#005F73]">
                <h2 class="text-2xl font-bold text-[#005F73] mb-4 flex items-center">
                    Simulador Gemini de Preço Futuro ✨
                </h2>
                <p class="text-gray-700 mb-6">
                    Projete o preço da gasolina ao consumidor final (R$/Litro) inserindo seus próprios cenários para o Dólar e o Petróleo Brent. O analista Gemini fará a estimativa e fornecerá a justificativa econômica.
                </p>
                
                <div class="flex flex-col md:flex-row gap-4 mb-6 items-end">
                    <div class="flex-1 w-full">
                        <label for="dollarInput" class="block text-sm font-medium text-gray-700">Cotação Dólar (R$/US$)</label>
                        <input type="number" step="0.01" id="dollarInput" value="5.20" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2.5" placeholder="Ex: 5.20">
                    </div>
                    <div class="flex-1 w-full">
                        <label for="brentInput" class="block text-sm font-medium text-gray-700">Petróleo Brent (US$/Barril)</label>
                        <input type="number" step="1" id="brentInput" value="95" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2.5" placeholder="Ex: 95">
                    </div>
                    <button id="simulateButton" onclick="simulatePrice()" class="w-full md:w-auto px-6 py-2.5 bg-[#0A9396] text-white font-bold rounded-lg hover:bg-[#005F73] transition duration-200 flex items-center justify-center">
                        <span id="buttonText">Simular Preço Final ✨</span>
                        <div id="loadingIndicator" class="loading-animation hidden ml-2"></div>
                    </button>
                </div>

                <!-- Área de Resultados -->
                <div id="resultArea" class="mt-6 p-4 bg-white rounded-lg shadow-md border-l-4 border-gray-400 hidden">
                    <p class="text-lg font-bold text-[#005F73] mb-2">Análise de Cenário:</p>
                    <div id="geminiOutput" class="text-gray-700"></div>
                    <div id="sources" class="text-xs text-gray-500 mt-4 italic"></div>
                </div>

            </section>
            
            <!-- Seção de Composição e Fluxo (Mantida) -->
            <section class="grid grid-cols-1 md:grid-cols-5 gap-8 items-center">
                <div class="md:col-span-3 bg-white rounded-lg shadow-lg p-6 md:p-8">
                    <h2 class="text-2xl font-bold text-[#005F73] mb-4">Composição Estrutural do Preço</h2>
                    <p class="text-gray-600 mb-6">
                        A estrutura de custo não mudou drasticamente em 45 anos, sendo dominada por duas forças principais: o custo de insumo (Petrobras, Dólar e Etanol) e a intervenção estatal (Impostos).
                    </p>
                    <div class="space-y-4">
                        <div class="flex items-center">
                            <div class="w-8 h-8 rounded-full bg-[#005F73] flex items-center justify-center text-white font-bold mr-4">1</div>
                            <span class="font-semibold text-gray-700">Petróleo Brent + Câmbio (Dólar)</span>
                        </div>
                        <div class="ml-4 pl-5 border-l-2 border-dashed border-[#94D2BD]">
                            <div class="text-4xl text-[#94D2BD] -ml-9 mt-1 mb-1">↓</div>
                        </div>
                        <div class="flex items-center">
                            <div class="w-8 h-8 rounded-full bg-[#0A9396] flex items-center justify-center text-white font-bold mr-4">2</div>
                            <span class="font-semibold text-gray-700">Preço de Realização da Petrobras (Refino)</span>
                        </div>
                         <div class="ml-4 pl-5 border-l-2 border-dashed border-[#94D2BD]">
                            <div class="text-4xl text-[#94D2BD] -ml-9 mt-1 mb-1">↓</div>
                        </div>
                        <div class="flex items-center">
                             <div class="w-8 h-8 rounded-full bg-[#94D2BD] flex items-center justify-center text-black font-bold mr-4">3</div>
                            <span class="font-semibold text-gray-700">Adição de Biocombustível (Etanol Anidro)</span>
                        </div>
                         <div class="ml-4 pl-5 border-l-2 border-dashed border-[#94D2BD]">
                            <div class="text-4xl text-[#94D2BD] -ml-9 mt-1 mb-1">↓</div>
                        </div>
                         <div class="flex items-center">
                             <div class="w-8 h-8 rounded-full bg-[#BB3E03] flex items-center justify-center text-white font-bold mr-4">4</div>
                            <span class="font-semibold text-gray-700 font-bold">Carga Tributária Total (Federais: PIS/Cofins, CIDE e Estadual: ICMS)</span>
                        </div>
                         <div class="ml-4 pl-5 border-l-2 border-dashed border-[#94D2BD]">
                            <div class="text-4xl text-[#94D2BD] -ml-9 mt-1 mb-1">↓</div>
                        </div>
                         <div class="flex items-center">
                             <div class="w-8 h-8 rounded-full bg-[#EE9B00] flex items-center justify-center text-white font-bold mr-4">5</div>
                            <span class="font-semibold text-gray-700">Custos de Distribuição e Revenda</span>
                        </div>
                    </div>
                </div>
                <div class="md:col-span-2">
                    <div class="chart-container h-[400px] max-h-[400px]">
                         <canvas id="compositionChart"></canvas>
                    </div>
                    <p class="text-center font-semibold text-gray-700 mt-2">Composição Média do Preço Final (Atual)</p>
                </div>
            </section>
            
            <!-- Seção de Descolamentos Históricos (Mantida) -->
            <section>
                <h2 class="text-2xl font-bold text-[#005F73] mb-6 text-center">Descolamentos Históricos (1980-2025)</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="font-bold text-xl text-[#AE2012] mb-2">1980-1994: Controle e Crise</h3>
                        <p class="text-gray-600">Durante as crises do petróleo e a hiperinflação, o preço da gasolina era determinado por decretos governamentais. A instabilidade do Dólar e a alta inflação (que não aparece linearmente no gráfico) geravam uma distorção constante, com subsídios mascarando o custo real.</p>
                    </div>
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="font-bold text-xl text-[#AE2012] mb-2">1994: Plano Real</h3>
                        <p class="text-gray-600">A vinculação cambial ($1=R$1) estabilizou momentaneamente a gasolina a um preço baixo e estável. O preço na bomba se descola da inflação e das crises externas, mas esse controle cambial leva ao esgotamento em poucos anos.</p>
                    </div>
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="font-bold text-xl text-[#AE2012] mb-2">2008: O Pico do Brent</h3>
                        <p class="text-gray-600">O petróleo atingiu seu recorde de $147 o barril. No entanto, o preço da gasolina no Brasil foi segurado e o Dólar estava relativamente baixo (R$ 1,85), evitando que o preço final disparasse, graças a subsídios da Petrobras (descolamento por intervenção).</p>
                    </div>
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="font-bold text-xl text-[#AE2012] mb-2">2022: Guerra e Desoneração Fiscal</h3>
                        <p class="text-gray-600">O maior exemplo do poder do imposto. Com o Brent acima de $100 e o Dólar alto, o preço ao consumidor despencou devido à intervenção fiscal (redução drástica do ICMS e PIS/Cofins - **linha vermelha caindo**), provando que o imposto é a alavanca mais forte.</p>
                    </div>
                </div>
            </section>

        </main>
        
        <footer class="text-center mt-12 pt-8 border-t border-gray-300">
            <p class="text-gray-500">Análise baseada em dados históricos (1980-2025). Valores de Gasolina e Impostos pré-1994 são ajustados ao Real de 2025 para fins de comparação. O Simulador Gemini utiliza o modelo gemini-2.5-flash-preview-05-20 com Google Search para grounding.</p>
        </footer>

    </div>

    <script>
        // Função utilitária para lidar com o retry de chamadas de API
        async function exponentialBackoffFetch(url, options, maxRetries = 5, delay = 1000) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok) return response;
                    if (response.status === 429 && i < maxRetries - 1) { // 429: Too Many Requests
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2; // Atraso exponencial
                    } else {
                        throw new Error(`API returned status ${response.status}: ${response.statusText}`);
                    }
                } catch (error) {
                    if (i === maxRetries - 1) throw error;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
            }
        }

        async function simulatePrice() {
            const dollar = document.getElementById('dollarInput').value;
            const brent = document.getElementById('brentInput').value;
            const resultArea = document.getElementById('resultArea');
            const geminiOutput = document.getElementById('geminiOutput');
            const sourcesDiv = document.getElementById('sources');
            const simulateButton = document.getElementById('simulateButton');
            const buttonText = document.getElementById('buttonText');
            const loadingIndicator = document.getElementById('loadingIndicator');

            if (!dollar || !brent || isNaN(parseFloat(dollar)) || isNaN(parseFloat(brent))) {
                geminiOutput.innerHTML = '<span class="text-red-600 font-bold">Por favor, insira valores válidos para Dólar e Petróleo Brent.</span>';
                resultArea.classList.remove('hidden');
                return;
            }

            // UI feedback: loading state
            simulateButton.disabled = true;
            buttonText.textContent = 'Simulando...';
            loadingIndicator.classList.remove('hidden');
            resultArea.classList.add('hidden');
            geminiOutput.innerHTML = '';
            sourcesDiv.innerHTML = '';

            try {
                const systemPrompt = "Aja como um analista financeiro brasileiro especializado em commodities e energia. Use a estrutura de composição de preço média apresentada (aprox. 41% impostos, 34% Petrobras/Refino, 15% Etanol, 10% Distribuição) para projetar o preço final da gasolina ao consumidor. Apresente uma estimativa clara do preço final formatada como **Gasolina Estimada: R$ X,XX/Litro** seguida pela justificativa econômica em um único parágrafo conciso. A justificativa deve citar explicitamente a influência do câmbio, do Brent e da carga tributária.";
                
                const userQuery = `Simule o preço final da gasolina ao consumidor (R$/Litro) se o Dólar estivesse em R$${dollar} e o Petróleo Brent estivesse em $${brent}. Justifique sua estimativa com base na estrutura de custos brasileira e nas políticas fiscais atuais (PIS/Cofins, ICMS).`;
                
                const apiKey = "AIzaSyCd5-deATMmq45Jrgzhdi8vHEHHFhd51gs"; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    tools: [{ "google_search": {} }], // Google Search Grounding para dados fiscais recentes
                    systemInstruction: {
                        parts: [{ text: systemPrompt }]
                    },
                };

                const response = await exponentialBackoffFetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const text = candidate.content.parts[0].text;
                    
                    let sources = [];
                    const groundingMetadata = candidate.groundingMetadata;
                    if (groundingMetadata && groundingMetadata.groundingAttributions) {
                        sources = groundingMetadata.groundingAttributions
                            .map(attribution => ({
                                uri: attribution.web?.uri,
                                title: attribution.web?.title,
                            }))
                            .filter(source => source.uri && source.title);
                    }

                    // Display results
                    geminiOutput.innerHTML = text.replace(/\*\*(.*?)\*\*/g, '<span class="text-xl font-extrabold text-[#BB3E03]">$1</span>');
                    
                    if (sources.length > 0) {
                        sourcesDiv.innerHTML = 'Fontes de Dados (para grounding): ' + sources.map(s => `<a href="${s.uri}" target="_blank" class="underline hover:text-[#0A9396]">${s.title}</a>`).join(' | ');
                    }
                    
                } else {
                    geminiOutput.innerHTML = '<span class="text-red-600 font-bold">Erro: Não foi possível obter a análise. Tente novamente.</span>';
                }

            } catch (error) {
                console.error("Gemini API Error:", error);
                geminiOutput.innerHTML = `<span class="text-red-600 font-bold">Erro na comunicação com a API: ${error.message}.</span>`;
            } finally {
                // UI feedback: reset state
                simulateButton.disabled = false;
                buttonText.textContent = 'Simular Preço Final ✨';
                loadingIndicator.classList.add('hidden');
                resultArea.classList.remove('hidden');
            }
        }

        // --- Chart Initialization (Existing code) ---
        document.addEventListener('DOMContentLoaded', function () {
            
            const labels = ['1980', '1985', '1990', '1994 (Real)', '1998', '2001', '2004', '2008', '2011', '2014', '2016', '2018', '2020', '2022', '2025'];
            const gasolinePrices = [2.50, 2.30, 2.10, 1.05, 1.85, 2.35, 2.50, 2.55, 2.70, 2.90, 3.67, 4.28, 4.40, 6.30, 5.85];
            const oilPrices = [37, 27, 20, 17, 14, 25, 38, 97, 111, 99, 45, 71, 42, 101, 88];
            const dollarRates = [1.00, 1.00, 1.00, 0.85, 1.18, 2.32, 2.93, 1.85, 1.67, 2.35, 3.49, 3.65, 5.39, 5.16, 5.25];
            const taxPrices = [0.40, 0.45, 0.50, 0.20, 0.45, 0.70, 0.90, 1.05, 1.15, 1.20, 1.65, 1.95, 2.25, 1.30, 2.40]; 

            const trendsCtx = document.getElementById('trendsChart').getContext('2d');
            new Chart(trendsCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Gasolina (R$ / Litro - Ajustado)',
                            data: gasolinePrices,
                            borderColor: '#005F73',
                            backgroundColor: '#005F73',
                            yAxisID: 'yBRL',
                            tension: 0.3,
                            borderWidth: 4
                        },
                        {
                            label: 'Total Impostos (R$ / Litro)',
                            data: taxPrices,
                            borderColor: '#AE2012', 
                            backgroundColor: '#AE2012',
                            yAxisID: 'yBRL',
                            tension: 0.3,
                            borderWidth: 2,
                            borderDash: [2, 2]
                        },
                        {
                            label: 'Dólar (R$ / US$)',
                            data: dollarRates,
                            borderColor: '#94D2BD',
                            backgroundColor: '#94D2BD',
                            yAxisID: 'yBRL',
                            tension: 0.3,
                            borderWidth: 2,
                            borderDash: [5, 5]
                        },
                        {
                            label: 'Petróleo Brent ($ / Barril)',
                            data: oilPrices,
                            borderColor: '#EE9B00',
                            backgroundColor: '#EE9B00',
                            yAxisID: 'yUSD',
                            tension: 0.3,
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    scales: {
                        yBRL: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Valor em Reais (R$)'
                            },
                            grid: {
                                drawOnChartArea: false, 
                            },
                            min: 0,
                            max: 7 
                        },
                        yUSD: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Valor em Dólares ($)'
                            },
                            grid: {
                                drawOnChartArea: true,
                                color: '#E0E0E0'
                            },
                            min: 0,
                            max: 120 
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    const item = tooltipItems[0];
                                    let label = item.chart.data.labels[item.dataIndex];
                                    if (Array.isArray(label)) {
                                      return label.join(' ');
                                    } else {
                                      return label;
                                    }
                                }
                            }
                        }
                    }
                }
            });
            
            const compositionCtx = document.getElementById('compositionChart').getContext('2d');
            new Chart(compositionCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Realização Petrobras (34%)', ['Total de Impostos', '(Federais + Estaduais) (41%)'], 'Custo Etanol Anidro (15%)', 'Distribuição e Revenda (10%)'],
                    datasets: [{
                        data: [34, 41, 15, 10], 
                        backgroundColor: ['#005F73', '#BB3E03', '#94D2BD', '#EE9B00'], 
                        borderColor: '#F0F4F8',
                        borderWidth: 4,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                boxWidth: 15,
                                padding: 15
                            }
                        },
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    const item = tooltipItems[0];
                                    let label = item.chart.data.labels[item.dataIndex];
                                    if (Array.isArray(label)) {
                                      return label.join(' ');
                                    } else {
                                      return label;
                                    }
                                }
                            }
                        }
                    }
                }
            });

        });
    </script>

</body>
</html>
